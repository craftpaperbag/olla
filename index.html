<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Olla</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <style>
    :root {
      color-scheme: light dark;
      --bg: radial-gradient(circle at 20% 20%, #e7f0ff, transparent 40%),
        radial-gradient(circle at 80% 0%, #ffe8f0, transparent 35%),
        linear-gradient(180deg, #0f1624, #101828);
      --card: rgba(255, 255, 255, 0.1);
      --shadow: 0 20px 80px rgba(0, 0, 0, 0.35);
      --accent: #7dd3fc;
      --border: rgba(255, 255, 255, 0.08);
      --text: #e5e7eb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
    }

    .app {
      width: min(1100px, 100%);
      background: rgba(12, 17, 31, 0.78);
      border: 1px solid var(--border);
      border-radius: 24px;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-rows: auto 1fr auto;
      backdrop-filter: blur(14px);
      overflow: hidden;
      height: min(900px, 90vh);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(12, 17, 31, 0.95), rgba(12, 17, 31, 0.7));
      z-index: 3;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      letter-spacing: 0.3px;
      font-size: 18px;
    }

    .brand svg {
      width: 28px;
      height: 28px;
      fill: var(--accent);
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    button.icon {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--border);
      color: var(--text);
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: border 0.2s ease, transform 0.15s ease;
    }

    button.icon:hover {
      border-color: var(--accent);
    }

    button.icon:active {
      transform: translateY(1px);
    }

    .mock-banner {
      display: none;
      padding: 10px 18px;
      border-bottom: 1px solid var(--border);
      background: rgba(234, 179, 8, 0.12);
      color: #facc15;
      font-size: 13px;
      letter-spacing: 0.3px;
      align-items: center;
      gap: 8px;
    }

    .mock-banner.show {
      display: flex;
    }

    .chat {
      padding: 12px 18px 12px;
      overflow-y: auto;
      scrollbar-width: thin;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .bubble {
      padding: 14px 16px;
      border-radius: 18px;
      width: min(820px, 100%);
      line-height: 1.6;
      font-size: 15px;
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.25);
      border: 1px solid var(--border);
    }

    .user {
      align-self: flex-end;
      background: linear-gradient(135deg, #121826, #0d111c);
      margin-left: auto;
    }

    .assistant {
      align-self: flex-start;
      background: rgba(255, 255, 255, 0.04);
      margin-right: auto;
    }

    .error {
      border-color: #f87171;
      background: rgba(248, 113, 113, 0.14);
      color: #fecdd3;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .error .body {
      flex: 1;
    }

    .bubble h1,
    .bubble h2,
    .bubble h3,
    .bubble h4,
    .bubble h5,
    .bubble h6 {
      margin: 0.4em 0 0.2em;
    }

    .bubble pre {
      background: rgba(0, 0, 0, 0.25);
      padding: 12px;
      border-radius: 12px;
      overflow: auto;
      border: 1px solid var(--border);
    }

    .bubble code {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .bubble ul,
    .bubble ol {
      padding-left: 20px;
      margin: 0.4em 0;
    }

    form {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      padding: 16px;
      border-top: 1px solid var(--border);
      background: rgba(8, 12, 20, 0.85);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 200px;
      width: 100%;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      padding: 12px 14px;
      font-size: 15px;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.2);
    }

    button.send {
      padding: 0 16px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, #60a5fa, #a855f7);
      color: white;
      font-weight: 700;
      border-radius: 14px;
      cursor: pointer;
      min-width: 96px;
      transition: filter 0.2s ease, transform 0.1s ease;
    }

    button.send:active {
      transform: translateY(1px);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(6px);
      background: rgba(0, 0, 0, 0.5);
      z-index: 10;
    }

    .modal.open {
      display: flex;
    }

    .dialog {
      background: #0d1220;
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 20px;
      width: min(420px, 92vw);
      box-shadow: var(--shadow);
      display: grid;
      gap: 12px;
    }

    .dialog.about {
      width: min(520px, 94vw);
    }

    .dialog h3 {
      margin: 0;
      font-size: 18px;
    }

    label {
      display: grid;
      gap: 6px;
      font-size: 13px;
      color: #9ca3af;
    }

    input[type="text"],
    input[type="number"] {
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    .switch {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #cbd5e1;
    }

    .switch input {
      appearance: none;
      width: 44px;
      height: 24px;
      border-radius: 999px;
      position: relative;
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease;
    }

    .switch input::after {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .switch input:checked {
      background: linear-gradient(135deg, #60a5fa, #a855f7);
      border-color: #60a5fa;
    }

    .switch input:checked::after {
      transform: translateX(20px);
      background: #0f172a;
    }

    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(125, 211, 252, 0.15);
    }

    .dialog .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .dialog .row > * {
      flex: 1;
    }

    .badge {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: #cbd5e1;
    }

    .status {
      font-size: 12px;
      color: #94a3b8;
      min-height: 18px;
      text-align: right;
    }

    @media (max-width: 720px) {
      header { flex-wrap: wrap; gap: 10px; }
      form { grid-template-columns: 1fr; }
      button.send { width: 100%; min-height: 48px; }
      .bubble { max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2c-5.52 0-10 3.83-10 8.56 0 2.58 1.42 4.87 3.65 6.41-.18 1.09-.78 2.77-2.27 4.03a.5.5 0 0 0 .36.87c1.82-.08 4.19-.61 5.84-1.58A12.1 12.1 0 0 0 12 21c5.52 0 10-3.83 10-8.56C22 5.83 17.52 2 12 2Z"/></svg>
        <span>Olla</span>
        <span class="badge" id="modelBadge">ollama</span>
      </div>
      <div class="actions">
        <button class="icon" id="about" title="Ollaã¨ã¯?">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 15a1.25 1.25 0 1 1 1.25-1.25A1.252 1.252 0 0 1 12 17Zm1.75-5.25a1.75 1.75 0 0 1-.991 1.586c-.521.253-.759.426-.759.664V14a1 1 0 0 1-2 0v-.273c0-1.24.9-1.832 1.474-2.097.456-.207.526-.35.526-.63a.75.75 0 1 0-1.5 0 1 1 0 1 1-2 0 2.75 2.75 0 1 1 5.25 0Z"/></svg>
        </button>
        <button class="icon" id="download" title="å±¥æ­´ã‚’CSVã§ä¿å­˜">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 3a1 1 0 0 0-1 1v9.586l-2.293-2.293a1 1 0 0 0-1.414 1.414l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 1 0-1.414-1.414L13 13.586V4a1 1 0 0 0-1-1Z"/><path d="M5 18a1 1 0 0 0 0 2h14a1 1 0 1 0 0-2H5Z"/></svg>
        </button>
        <button class="icon" id="settings" title="æ¥ç¶šè¨­å®š">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 2a2 2 0 0 0-2 2v.126a7.97 7.97 0 0 0-1.73.72l-.084-.084A2 2 0 0 0 5.03 6.92l.084.084A7.97 7.97 0 0 0 4.392 8.73H4.25a2 2 0 1 0 0 4h.126c.156.61.407 1.19.73 1.73l-.084.084a2 2 0 1 0 2.828 2.828l.084-.084c.54.323 1.12.574 1.73.73v.126a2 2 0 1 0 4 0v-.126a7.97 7.97 0 0 0 1.73-.73l.084.084a2 2 0 0 0 2.828-2.828l-.084-.084c.323-.54.574-1.12.73-1.73h.126a2 2 0 1 0 0-4h-.126a7.97 7.97 0 0 0-.72-1.73l.084-.084a2 2 0 0 0-2.828-2.828l-.084.084a7.97 7.97 0 0 0-1.73-.72V4a2 2 0 0 0-2-2Zm-3 10a3 3 0 1 1 6 0 3 3 0 0 1-6 0Z"/></svg>
        </button>
        <button class="icon" id="clear" title="ä¼šè©±ã‚’å‰Šé™¤">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M10 3a1 1 0 0 0-.894.553L8.382 5H5a1 1 0 0 0 0 2h.08l1.01 12.123A2 2 0 0 0 8.082 21h7.836a2 2 0 0 0 1.992-1.877L18.92 7H19a1 1 0 1 0 0-2h-3.382l-.724-1.447A1 1 0 0 0 13 3h-3Zm1.118 2-.5-1H13l.5 1h-2.382ZM8.089 7h7.822l-.962 11.556a.001.001 0 0 1-.001.001L8.09 7Zm3.411 2v7a1 1 0 1 1-2 0V9a1 1 0 1 1 2 0Zm3 0v7a1 1 0 1 1-2 0V9a1 1 0 1 1 2 0Z"/></svg>
        </button>
      </div>
    </header>

    <div class="mock-banner" id="mockBanner" role="status" aria-live="polite">
      <span>ğŸ§ª</span>
      <span>ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­</span>
    </div>

    <div class="chat" id="chat"></div>

    <form id="composer">
      <textarea id="input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸..." required></textarea>
      <button type="submit" class="send" id="send">é€ä¿¡</button>
    </form>
  </div>

  <div class="modal" id="modal">
    <div class="dialog">
      <h3>æ¥ç¶šè¨­å®š</h3>
      <label>
        ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
        <input type="text" id="endpoint" placeholder="http://localhost:11434" />
      </label>
      <label>
        ãƒ¢ãƒ‡ãƒ«
        <input type="text" id="model" placeholder="llama3" />
      </label>
      <label>
        æ¸©åº¦
        <input type="number" id="temperature" step="0.1" min="0" max="2" />
      </label>
      <label class="switch" for="mockMode">
        <input type="checkbox" id="mockMode" />
        <span>ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰</span>
      </label>
      <div class="row">
        <button class="send" id="saveSettings" type="button">ä¿å­˜</button>
      </div>
      <div class="status" id="status" aria-live="polite"></div>
    </div>
  </div>

  <div class="modal" id="aboutModal">
    <div class="dialog about">
      <h3>Ollaã¨ã¯</h3>
      <p>Ollaã¯ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚„ãƒªãƒ¢ãƒ¼ãƒˆã®LLMã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æ¥ç¶šã—ã¦ä¼šè©±ã§ãã¾ã™ã€‚è¨­å®šã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã‚„æ¸©åº¦ã‚’èª¿æ•´ã—ã€ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§æŒ™å‹•ã‚’è©¦ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</p>
      <p>
        è©³ç´°ã‚„ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯
        <a href="https://github.com/craftpaperbag/olla" target="_blank" rel="noreferrer">craftpaperbag/olla</a>
        ã‚’ã”è¦§ãã ã•ã„ã€‚
      </p>
      <div class="row">
        <button class="send" id="closeAbout" type="button">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const defaults = {
      endpoint: "http://localhost:11434",
      model: "llama3",
      temperature: 0.7,
      mock: false,
    };

    const settingsKey = "olla.settings";
    const historyKey = "olla.history";
    const chatEl = document.getElementById("chat");
    const inputEl = document.getElementById("input");
    const formEl = document.getElementById("composer");
    const modalEl = document.getElementById("modal");
    const statusEl = document.getElementById("status");
    const mockBannerEl = document.getElementById("mockBanner");
    const mockToggleEl = document.getElementById("mockMode");
    const modelBadgeEl = document.getElementById("modelBadge");
    const aboutModalEl = document.getElementById("aboutModal");

    randomizeBackground();
    let settings = loadSettings();
    let history = loadHistory();
    renderHistory();
    updateMockBanner();
    updateModelBadge();

    document.getElementById("settings").addEventListener("click", () => {
      openModal();
    });

    document.getElementById("download").addEventListener("click", () => {
      downloadCsv();
    });

    document.getElementById("clear").addEventListener("click", () => {
      const ok = confirm("ä¼šè©±å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ");
      if (!ok) return;
      history = [];
      persistHistory();
      renderHistory();
    });

    document.getElementById("about").addEventListener("click", () => {
      aboutModalEl.classList.add("open");
    });

    document.getElementById("closeAbout").addEventListener("click", () => {
      closeAbout();
    });

    document.getElementById("saveSettings").addEventListener("click", () => {
      settings = {
        endpoint: document.getElementById("endpoint").value.trim() || defaults.endpoint,
        model: document.getElementById("model").value.trim() || defaults.model,
        temperature: Number(document.getElementById("temperature").value) || defaults.temperature,
        mock: mockToggleEl.checked,
      };
      localStorage.setItem(settingsKey, JSON.stringify(settings));
      statusEl.textContent = "ä¿å­˜ã—ã¾ã—ãŸ";
      updateMockBanner();
      updateModelBadge();
      setTimeout(closeModal, 700);
    });

    modalEl.addEventListener("click", (e) => {
      if (e.target === modalEl) closeModal();
    });

    aboutModalEl.addEventListener("click", (e) => {
      if (e.target === aboutModalEl) closeAbout();
    });

    formEl.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = "";
      appendMessage({ role: "user", content: text });
      streamResponse();
    });

    inputEl.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        e.preventDefault();
        formEl.requestSubmit();
      }
    });

    function loadSettings() {
      try {
        const saved = JSON.parse(localStorage.getItem(settingsKey));
        return { ...defaults, ...saved };
      } catch (e) {
        return { ...defaults };
      }
    }

    function loadHistory() {
      try {
        const saved = JSON.parse(localStorage.getItem(historyKey));
        return Array.isArray(saved) ? saved : [];
      } catch (e) {
        return [];
      }
    }

    function persistHistory() {
      localStorage.setItem(historyKey, JSON.stringify(history));
    }

    function renderHistory() {
      chatEl.innerHTML = "";
      history.forEach((msg) => renderMessage(msg));
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function setBubbleContent(node, content, isError) {
      if (isError) {
        node.classList.add("error");
        node.innerHTML = `<span aria-hidden="true">âš ï¸</span><div class="body">${marked.parse(content || "")}</div>`;
      } else {
        node.classList.remove("error");
        node.innerHTML = marked.parse(content || "");
      }
    }

    function renderMessage(msg) {
      const bubble = document.createElement("div");
      bubble.className = `bubble ${msg.role}`;
      setBubbleContent(bubble, msg.content, msg.error);
      chatEl.appendChild(bubble);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function appendMessage(msg) {
      history.push(msg);
      persistHistory();
      renderMessage(msg);
    }

    function openModal() {
      document.getElementById("endpoint").value = settings.endpoint;
      document.getElementById("model").value = settings.model;
      document.getElementById("temperature").value = settings.temperature;
      mockToggleEl.checked = !!settings.mock;
      statusEl.textContent = "";
      modalEl.classList.add("open");
    }

    function closeModal() {
      modalEl.classList.remove("open");
    }

    function closeAbout() {
      aboutModalEl.classList.remove("open");
    }

    async function streamResponse() {
      const sendBtn = document.getElementById("send");
      sendBtn.disabled = true;
      const conversation = history.map(({ role, content }) => ({ role, content }));
      const assistantMsg = { role: "assistant", content: "" };
      appendMessage(assistantMsg);

      if (settings.mock) {
        const mockText = generateMockResponse();
        const chars = Array.from(mockText);
        const timer = setInterval(() => {
          assistantMsg.content += chars.shift();
          updateLastAssistant(assistantMsg.content);
          if (!chars.length) {
            clearInterval(timer);
            persistHistory();
            sendBtn.disabled = false;
          }
        }, 45);
        return;
      }

      try {
        const res = await fetch(`${settings.endpoint.replace(/\/$/, "")}/api/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            model: settings.model,
            stream: true,
            options: { temperature: settings.temperature },
            messages: conversation,
          }),
        });

        if (!res.ok || !res.body) {
          throw new Error(`HTTP ${res.status}`);
        }

        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let buffer = "";

        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split("\n");
          buffer = lines.pop() || "";
          for (const line of lines) {
            if (!line.trim()) continue;
            try {
              const data = JSON.parse(line);
              if (data.message?.content) {
                assistantMsg.content += data.message.content;
                updateLastAssistant(assistantMsg.content);
              }
            } catch (err) {
              console.error("parse", err);
            }
          }
        }

        if (buffer.trim()) {
          try {
            const data = JSON.parse(buffer.trim());
            if (data.message?.content) {
              assistantMsg.content += data.message.content;
              updateLastAssistant(assistantMsg.content);
            }
          } catch (err) {
            console.error("tail parse", err);
          }
        }

      } catch (error) {
        assistantMsg.content = "æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        assistantMsg.error = true;
        updateLastAssistant(assistantMsg.content, { error: true });
      } finally {
        persistHistory();
        sendBtn.disabled = false;
      }
    }

    function updateLastAssistant(content, options = {}) {
      const nodes = chatEl.querySelectorAll(".assistant");
      const last = nodes[nodes.length - 1];
      if (last) {
        setBubbleContent(last, content, options.error);
        chatEl.scrollTop = chatEl.scrollHeight;
      }
      history[history.length - 1].content = content;
      if (options.error !== undefined) {
        history[history.length - 1].error = options.error;
      }
    }

    function downloadCsv() {
      if (!history.length) return;
      const rows = ["role,content"]; // timestamp optional
      history.forEach((msg) => {
        const safeContent = msg.content.replace(/"/g, '""').replace(/\n/g, "\\n");
        rows.push(`${msg.role},"${safeContent}"`);
      });
      const blob = new Blob([rows.join("\n")], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = `olla-chat-${new Date().toISOString().slice(0, 19).replace(/[:T]/g, "-")}.csv`;
      document.body.appendChild(link);
      link.click();
      link.remove();
      URL.revokeObjectURL(url);
    }

    function randomizeBackground() {
      const palette = ["#e7f0ff", "#ffe8f0", "#d9f99d", "#c7d2fe", "#fecdd3", "#99f6e4"];
      const pick = () => palette[Math.floor(Math.random() * palette.length)];
      const spot = () => `${Math.floor(Math.random() * 70) + 10}% ${Math.floor(Math.random() * 70) + 10}%`;
      const gradient = `radial-gradient(circle at ${spot()}, ${pick()}, transparent 40%),\n        radial-gradient(circle at ${spot()}, ${pick()}, transparent 38%),\n        linear-gradient(180deg, #0f1624, ${pick()})`;
      document.documentElement.style.setProperty("--bg", gradient);
    }

    function generateMockResponse() {
      const words = [
        "é™ã‹ãª", "ã²ã‚‰ã‚ã", "æœªæ¥", "å…‰", "å½±", "é¢¨", "æ—…", "èª¿å’Œ", "ã²ã¨ã¨ã", "ä½™ç™½", "é¼“å‹•", "å¤œæ˜ã‘", "ã–ã‚ã‚ã",
        "ãã‚‰ã‚ã", "ã²ãã‚„ã‹", "å°é›¨", "ä½™éŸ»", "è¼ªéƒ­", "é€æ˜", "é¡˜ã„", "ç¬ã",
      ];
      const count = Math.floor(Math.random() * 4) + 4;
      const parts = Array.from({ length: count }, () => words[Math.floor(Math.random() * words.length)]);
      return `${parts.join("ã€")}ã€‚`;
    }

    function updateMockBanner() {
      mockBannerEl.classList.toggle("show", !!settings.mock);
    }

    function updateModelBadge() {
      modelBadgeEl.textContent = settings.model || defaults.model;
    }
  </script>
</body>
</html>
